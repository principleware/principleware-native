!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.principlewareNative=e.principlewareNative||{})}(this,function(e){"use strict";function t(e,t){return function(){e.apply(t,arguments)}}var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function r(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(e){if(r)return;r=!0,n(e)}}function i(e){var t=this;if(null!==this._state){setTimeout(function(){var n,r;if(null!==(n=t._state?e.onFulfilled:e.onRejected)){try{r=n(t._value)}catch(t){return void e.reject(t)}e.resolve(r)}else(t._state?e.resolve:e.reject)(t._value)},1)}else this._deferreds.push(e)}function o(){var e,t;for(e=0,t=this._deferreds.length;e<t;e++)i.call(this,this._deferreds[e]);this._deferreds=null}function a(e){this._state=!1,this._value=e,o.call(this)}function s(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void r(t(n,e),t(s,this),t(a,this))}this._state=!0,this._value=e,o.call(this)}catch(e){a.call(this,e)}}function c(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],r(e,t(s,this),t(a,this))}c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){var n=this;return new c(function(r,o){i.call(n,new function(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}(e,t,r,o))})},c.prototype.all=function(e){var t=Array.prototype.slice.call(1===arguments.length&&n(e)?e:arguments);return new c(function(e,n){if(0===t.length)return e([]);var r,i=t.length;function o(r,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(e){o(r,e)},n)}t[r]=a,0==--i&&e(t)}catch(e){n(e)}}for(r=0;r<t.length;r++)o(r,t[r])})},c.prototype.resolve=function(e){return e&&"object"==typeof e&&e.constructor===c?e:new c(function(t){t(e)})},c.prototype.reject=function(e){return new c(function(t,n){n(e)})},c.prototype.race=function(e){return new c(function(t,n){var r,i;for(r=0,i=e.length;r<i;r++)e[r].then(t,n)})},c.prototype.always=function(e){return this.then(e,e)},c.prototype.done=function(e){return this.then(e)},c.prototype.fail=function(e){return this.then(null,e)},c.prototype.promise=function(){return this},c.prototype.progress=function(){return this};function u(e,t){return new c(function(n,r){if("function"==typeof e){for(var i=[],o=2;o<arguments.length;o++)i.push(arguments[o]);n(e.apply(t||null,i))}else n(e)})}function h(e,t){return e.replace(/\{([a-zA-Z]+)\}/g,function(e,n){return void 0===t[n]?"":t[n]})}var f={};function l(e,t){var n={name:e};return t.ios?n.iosDatabaseLocation="default":t.android&&(n.location="default"),n}var p=function(){function e(e,t,n,r){this.sqlite=e,this.dbName=t,this.dbSchema=n,this.platform=r}return e.prototype.initDBPromise=function(){var e=this,t=f[this.dbName];if(t)return t.referenceCounter=t.referenceCounter+1,u(t.database,null);var n=l(this.dbName,this.platform);return this.sqlite.create(n).then(function(t){var n=[];for(var r in e.dbSchema)if(e.dbSchema.hasOwnProperty(r)){var i=e.dbSchema[r];n.push(i.create)}var o=n.map(function(e){return t.executeSql(e,{})});return Promise.all(o).then(function(){return f[e.dbName]={referenceCounter:1,database:t},t})}).catch(function(e){return console.log(e)})},e.prototype.deleteDBPromise=function(){if(f[this.dbName])throw new Error("Still in use, please close first");var e=l(this.dbName,this.platform);return this.sqlite.deleteDatabase(e)},e.prototype.closeDBPromise=function(){var e=f[this.dbName];return e?(e.referenceCounter=e.referenceCounter-1,e.referenceCounter>0?u(!0,null):e.database.close()):u(!0,null)},e.prototype.insertPromise=function(e,t){var n=this.dbSchema[e],r=f[this.dbName];if(!r||!n)throw new Error("No database instance");return r.database.executeSql(n.insert,t).then(function(e){return e}).catch(function(e){return console.log(e),0})},e.prototype.selectPromise=function(e,t){var n=this.dbSchema[e],r=f[this.dbName];if(!r||!n)throw new Error("No database instance");return r.database.executeSql(t||n.select,{}).then(function(e){for(var t=[],n=0;n<e.rows.length;n++)t.push(e.rows.item(n));return t}).catch(function(e){return console.log(e),[]})},e.prototype.deletePromise=function(e,t,n){var r=this.dbSchema[e],i=f[this.dbName];if(!i||!r)throw new Error("No database instance");var o="";o=n?"WHERE id > "+t+" AND id < "+n:0===t?"WHERE id > 0":"WHERE id="+t;var a=h(r.remove,{where:o});return i.database.executeSql(a,{})},e.prototype.deleteWherePromise=function(e,t){var n=this.dbSchema[e],r=f[this.dbName];if(!r||!n)throw new Error("No database instance");var i=h(n.remove,{where:t});return r.database.executeSql(i,{})},e.prototype.updatePromise=function(e,t,n){void 0===n&&(n="");var r=this.dbSchema[e],i=f[this.dbName];if(!i||!r)throw new Error("No database instance");var o="UPDATE "+e+" SET "+t+" "+n;return i.database.executeSql(o,{})},e}(),d=function(){function e(e,t,n,r){this.tableName=e,this.configuration=t,this.database=n,this._cache=r}return e.prototype.insertP=function(e,t){t=this.configuration[e].parser.call(null,t);return this.database.insertPromise(this.tableName,[e,t]).then(function(n){var r={key:e,value:t,id:n};if(this.cache){var i=this.configuration[e].cacheKey;this._cache.set(i,r,120)}return r})},e.prototype.updateP=function(e,t){if(t=this.configuration[e.key].parser.call(null,t),0===e.id)return this.insertP(e.key,t);return this.database.updatePromise(this.tableName,"value = "+("string"==typeof t?'"'+t+'"':t),"WHERE id = "+e.id).then(function(){if(this._cache){var n=this.configuration[e.key].cacheKey;e.value=t,this._cache.set(n,e,120)}return e})},e.prototype.getP=function(e){if(this._cache){var t=this._cache.get(this.configuration[e].cacheKey);if(t)return u(t,null)}var n="SELECT * FROM "+this.tableName+' WHERE key like "'+e+'"';return this.database.selectPromise(this.tableName,n).then(function(t){var n;if(t.length>0?(n={key:e,value:t[0],id:t[0].id},this.configuration[e].reader&&(n.value=this.configuration[e].reader.call(null,n.value))):n={key:e,value:this.configuration[e].defaultValue,id:0},this._cache){var r=this.configuration[e].cacheKey;this._cache.set(r,n,120)}return n})},e.prototype.resetP=function(){return this._cache&&this._cache.reset(),this.database.deletePromise(this.tableName,0)},e}();e.SqliteDatabase=p,e.MapTable=d,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=principleware-native.umd.min.js.map
